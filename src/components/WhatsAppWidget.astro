---
import { X } from "@lucide/astro";
import { svg, div, script } from "framer-motion/client";

const phone = "51973847990";
const message =
    "Hola, necesito mÃ¡s informaciÃ³n sobre sus productos de asfalto.";
const whatsappUrl = `https://wa.me/${phone}?text=${encodeURIComponent(message)}`;
---

<div
    x-data="{ open: false, showHint: true }"
    class="fixed bottom-6 right-6 z-50 flex items-end gap-3"
>
    <!-- HINT MESSAGE -->
    <div
        x-show="showHint && !open"
        x-transition.opacity
        class="bg-white text-gray-700 text-sm px-4 py-2 rounded-xl shadow-lg max-w-[220px]"
    >
        Â¿Necesitas ayuda? <br />
        <span class="font-semibold text-green-600">ContÃ¡ctanos</span>
    </div>

    <!-- CHAT + BUTTON -->
    <div class="relative">
        <!-- CHAT BOX -->
        <div
            x-show="open"
            x-transition.opacity.scale.origin.bottom.right
            class="absolute bottom-16 right-0 w-72 rounded-2xl shadow-2xl bg-white overflow-hidden"
        >
            <!-- HEADER -->
            <div
                class="bg-green-500 text-white p-4 flex items-center justify-between"
            >
                <div>
                    <p class="font-semibold leading-none">WhatsApp</p>
                    <p class="text-xs opacity-90">Asesor en lÃ­nea</p>
                </div>
                <button
                    @click="
            open = false;
            showHint = true;
          "
                    aria-label="Cerrar"
                    class="cursor-pointer"
                >
                    <X size={18} />
                </button>
            </div>

            <!-- BODY -->
            <div class="p-4 space-y-3 text-sm text-gray-700">
                <p>ðŸ‘‹ Hola, Â¿en quÃ© podemos ayudarte?</p>

                <a
                    href={whatsappUrl}
                    target="_blank"
                    rel="noopener noreferrer"
                    class="block text-center bg-green-500 hover:bg-green-600 text-white py-2 rounded-lg transition"
                >
                    Escribir por WhatsApp
                </a>
            </div>
        </div>

        <!-- FLOAT BUTTON -->
        <button
            @click="
        open = !open;
        showHint = !open ? true : false;
      "
            class="w-14 h-14 rounded-full bg-green-500 hover:bg-green-600 shadow-xl flex items-center justify-center transition cursor-pointer"
            aria-label="Abrir WhatsApp"
        >
            <!-- WHATSAPP ICON -->
            <svg
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 32 32"
                fill="white"
                class="w-7 h-7"
            >
                <path
                    d="M16 .5C7.44.5.5 7.44.5 16c0 2.82.74 5.57 2.15 8L0 32l8.23-2.6A15.42 15.42 0 0 0 16 31.5C24.56 31.5 31.5 24.56 31.5 16S24.56.5 16 .5zm0 28.2c-2.55 0-5.04-.68-7.2-1.97l-.52-.3-4.88 1.54 1.59-4.75-.34-.55A12.69 12.69 0 0 1 3.3 16C3.3 8.95 8.95 3.3 16 3.3S28.7 8.95 28.7 16 23.05 28.7 16 28.7zm7.3-9.6c-.4-.2-2.37-1.17-2.74-1.3-.37-.14-.64-.2-.9.2-.27.4-1.04 1.3-1.28 1.57-.24.27-.47.3-.87.1-.4-.2-1.7-.63-3.25-2.02-1.2-1.07-2-2.4-2.23-2.8-.24-.4-.03-.6.18-.8.2-.2.4-.47.6-.7.2-.23.27-.4.4-.67.13-.27.07-.5-.03-.7-.1-.2-.9-2.17-1.23-2.97-.32-.77-.65-.67-.9-.68h-.77c-.27 0-.7.1-1.07.5s-1.4 1.37-1.4 3.35 1.44 3.9 1.64 4.17c.2.27 2.84 4.33 6.88 6.07.96.42 1.7.67 2.28.86.96.3 1.83.26 2.52.16.77-.12 2.37-.97 2.7-1.9.33-.93.33-1.73.23-1.9-.1-.17-.37-.27-.77-.47z"
                ></path>
            </svg>
        </button>
    </div>
</div>

<!-- AlpineJS -->
<script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>